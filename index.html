<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- jQuery UI（ドラッグ機能用） -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ページタイトル（タブの名前） -->
    <title>MANY VOICES, ONE VOICE</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet">

    <!-- デザイン（見た目）をまとめたCSSファイルを読み込む -->
    <link rel="stylesheet" href="index.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
    <!-- 画面全体を包むコンテナ -->
    <div class="page-wrapper">
        <!-- ヘッダー部分：タイトルとサブタイトル -->
        <header class="page-header header-with-bg">
            <div class="header-bg-img"></div>
            <div class="header-content">
                <h1 class="main-title">
                    MANY VOICES, ONE VOICE<br>
                    <span class="main-title-sub">Let’s Share What’s on Our Minds, Freely.</span>
                </h1>
                <p class="caption">
                    一人ひとり違って当然。自由にいろんな声を聴こう、みんなでひとつを進めよう。
                </p>
            </div>
        </header>


        <!-- ヘッダーとキャンバスの間にまとめ表示 -->
        <div id="summaryDisplay" class="summary-display"
            style="width:100%;text-align:center;font-size:1.6rem;font-weight:bold;margin:0 0 16px 0;padding:12px 0;color:#333;display:none;">
        </div>

        <!-- みんなの声が集まるキャンバス：最上部＆メイン表示 -->
        <main class="section section-canvas main-canvas-top">
            <h2 class="section-title" data-tooltip="ページを開いた瞬間、アートのようにみんなの声が広がるキャンバスです。">みんなの声が集まるキャンバス</h2>
            <div class="canvas-area">
                <!-- まとめポップアップ表示ボタン（右上） -->
                <button id="showSummaryBtn" class="summary-popup-btn"
                    style="position:absolute;top:18px;right:18px;z-index:10;display:none;">まとめを見る</button>
                <div class="question-card">
                    <div class="question-label">みんなで考える「問い」</div>
                    <div id="questionDisplay" class="question-text">
                        <span class="rainbow-question">？</span>
                    </div>
                </div>
                <div id="bubbleArea" class="bubble-area"></div>
                <!-- まとめポップアップ本体 -->
                <div id="summaryPopup" class="summary-popup" style="display:none;">
                    <div class="summary-popup-content">
                        <span id="closeSummaryPopup" class="close-popup">×</span>
                        <div id="summaryPopupText"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 下部：問題提示者用・回答者用セクション -->
        <div class="bottom-sections">
            <!-- 下部：左右分割レイアウト -->
            <div class="bottom-sections side-by-side">
                <div class="left-side">
                    <!-- 回答者用 -->
                    <section class="section section-voice">
                        <h2 class="section-title" data-tooltip="自分の考えやアイデアを自由に書いて、『みんなの声』をキャンバスに増やしてみましょう。">
                            テーマ回答者の「声」を書いてみよう</h2>
                        <div class="form-row">
                            <label for="nameInput" class="form-label">ニックネーム（任意）</label>
                            <input id="nameInput" class="text-input" type="text" placeholder="例）まいまい、かっしーなど">
                        </div>
                        <div class="form-row">
                            <label for="voiceInput" class="form-label">あなたの「声」・アイデア</label>
                            <textarea id="voiceInput" class="textarea" rows="3"
                                placeholder="例）少人数でじっくり話せる時間と、全員でゲームできる時間がどちらもあると嬉しいです。"></textarea>
                        </div>
                        <button id="addVoiceBtn" class="btn-secondary">スピーチバブルとしてキャンバスに追加する</button>
                    </section>
                </div>
                <div class="right-side">
                    <!-- 問題提示者用 -->
                    <section class="section section-question">
                        <h2 class="section-title" data-tooltip="懇親会や話し合いのテーマにしたい『問い』を入力して、キャンバスの中心にセットします。">
                            テーマ提示者が「問い」を立てる</h2>
                        <div class="form-row">
                            <label for="questionInput" class="form-label">みんなに聞いてみたい「問い」</label>
                            <textarea id="questionInput" class="text-input" rows="8"
                                style="height:132px;min-height:132px;"
                                placeholder="例）どんな懇親会だったら、参加してよかったと思えますか？"></textarea>
                        </div>
                        <button id="setQuestionBtn" class="btn-primary">キャンバスの中心に問いをセットする</button>
                    </section>
                </div>
            </div>



            <!-- ページ最下部：まとめ入力＆表示 -->
            <div class="section section-summary-bottom" style="width:100%;margin:0 auto;padding:32px 0 24px 0;">
                <h2 class="section-title" style="text-align:center;">テーマ提示者のまとめ・次の一歩</h2>
                <div class="form-row" style="text-align:center;">
                    <label for="summaryInput" class="form-label"
                        style="display:block;text-align:center;">まとめ・次に進めたいこと</label>
                    <textarea id="summaryInput" class="textarea" rows="3"
                        style="margin:0 auto;display:block;text-align:center;"
                        placeholder="例）まずは○○な雰囲気を大事にしながら、ゲームを1つと、少人数トークの時間をつくります。">テストにしました</textarea>
                </div>
                <button id="setSummaryBtn"
                    style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#6c8cff 60%,#9f7bff 100%);color:#fff;border:none;display:block;margin:16px auto;font-size:1rem;line-height:80px;text-align:center;box-shadow:0 8px 24px rgba(60,60,120,0.22),0 2px 8px rgba(60,60,120,0.12);transition:box-shadow 0.2s, transform 0.1s, background 0.2s;cursor:pointer;">まとめ</button>
                <div style="text-align:center; color:#666; font-size:0.95rem; margin-top:8px;">※まとめはページの上に表示されます</div>
                <style>
                    /* 全体の横幅をレスポンシブに */
                    .page-wrapper {
                        max-width: 900px;
                        width: 100%;
                        margin: 0 auto;
                        padding: 0 12px;
                        box-sizing: border-box;
                    }

                    #setSummaryBtn:hover {
                        box-shadow: 0 16px 40px rgba(60, 60, 120, 0.32), 0 6px 18px rgba(60, 60, 120, 0.18);
                        background: linear-gradient(135deg, #9f7bff 0%, #6c8cff 100%);
                        transform: translateY(-4px) scale(1.06);
                    }

                    #setSummaryBtn.set {
                        background: linear-gradient(135deg, #4caf50 60%, #43ea7f 100%) !important;
                        color: #fff !important;
                    }
                </style>
            </div>


        </div> <!-- /.page-wrapper -->

        <!-- ツールチップ表示用 -->
        <div id="sectionTooltip" class="section-tooltip" style="display:none;"></div>

        <script>
            // ページの読み込みが終わったら、ここから中身を実行する
            $(function () {
                // セクションタイトルのツールチップ表示
                var $tooltip = $('#sectionTooltip');
                $('.section-title[data-tooltip]').on('mouseenter', function (e) {
                    var text = $(this).data('tooltip');
                    $tooltip.text(text).fadeIn(120);
                    var offset = $(this).offset();
                    var top = offset.top + $(this).outerHeight() + 4;
                    var left = offset.left + $(this).outerWidth() - $tooltip.outerWidth() - 12;
                    $tooltip.css({
                        top: top,
                        left: left
                    });
                }).on('mouseleave', function () {
                    $tooltip.fadeOut(80);
                });

                // 1. 「問い」をセットするボタンの処理
                $("#setQuestionBtn").on("click", function () {
                    const question = $("#questionInput").val().trim(); // 入力された問いの文字を取得

                    if (question === "") {
                        alert("問いを入力してください。");
                        return; // 何も書かれていない場合は処理を中断
                    }

                    // 中央のカードに問いを表示
                    $("#questionDisplay").text(question);
                });

                // 虹色アニメーション
                var css = document.createElement('style');
                css.innerHTML = `
    .rainbow-question {
      font-size: 4.2rem;
      font-weight: 900;
      display: inline-block;
      background: linear-gradient(135deg, #ffb6c1, #ffd700, #90ee90, #87cefa, #ff69b4, #ffa07a, #20b2aa, #9370db, #ff6347, #40e0d0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      animation: rainbowQ 2.2s linear infinite alternate;
      font-family: 'BIZ UDPGothic', system-ui, sans-serif;
      letter-spacing: 0.04em;
    }
    @keyframes rainbowQ {
      0% { filter: drop-shadow(0 0 8px #fff) brightness(1.1); }
      50% { filter: drop-shadow(0 0 18px #ffd700) brightness(1.3); }
      100% { filter: drop-shadow(0 0 8px #fff) brightness(1.1); }
    }
  `;
                document.head.appendChild(css);

                // 「問い」入力時は?を消す
                $('#setQuestionBtn').on('click', function () {
                    var question = $('#questionInput').val().trim();
                    if (question !== '') {
                        $('#questionDisplay').html('<span class="rainbow-question question-text-small">' + question + '</span>');
                    }
                });

                // 2. 「声」をスピーチバブルとして追加するボタンの処理
                $("#addVoiceBtn").on("click", function () {
                    const name = $("#nameInput").val().trim();
                    const voice = $("#voiceInput").val().trim();

                    if (voice === "") {
                        alert("あなたの声・アイデアを入力してください。");
                        return;
                    }

                    // スピーチバブルの中身となるテキストを作成
                    // ニックネームがあれば「◯◯：本文」という形にする
                    let bubbleText = voice;
                    if (name !== "") {
                        bubbleText = name + "： " + voice;
                    }

                    // ランダムな斜めグラデーション色リスト
                    const gradients = [
                        'linear-gradient(135deg, #FFB6C1, #FFD700)',
                        'linear-gradient(135deg, #90EE90, #87CEFA)',
                        'linear-gradient(135deg, #FF69B4, #FFA07A)',
                        'linear-gradient(135deg, #20B2AA, #9370DB)',
                        'linear-gradient(135deg, #FF6347, #40E0D0)',
                        'linear-gradient(135deg, #F08080, #B0E0E6)',
                        'linear-gradient(135deg, #E6E6FA, #FFDEAD)',
                        'linear-gradient(135deg, #98FB98, #AFEEEE)',
                        'linear-gradient(135deg, #FFC0CB, #BDB76B)',
                        'linear-gradient(135deg, #00FA9A, #4682B4)',
                        'linear-gradient(135deg, #DDA0DD, #FF4500)',
                        'linear-gradient(135deg, #00CED1, #7B68EE)',
                        'linear-gradient(135deg, #FF8C00, #00BFFF)',
                        'linear-gradient(135deg, #32CD32, #FF00FF)',
                        'linear-gradient(135deg, #00FF7F, #1E90FF)',
                        'linear-gradient(135deg, #FF1493, #FFD700)'
                    ];
                    const gradient = gradients[Math.floor(Math.random() * gradients.length)];
                    // スピーチバブルの中にテキストを入れる構造
                    const $bubbleText = $('<div></div>')
                        .addClass('speech-bubble-text')
                        .text(bubbleText);
                    const $bubble = $('<div></div>')
                        .addClass('speech-bubble')
                        .append($bubbleText)
                        .css('background', gradient);

                    // 表示位置ロジック
                    // 中央の問い（question-card）領域を避ける
                    var tries = 0;
                    var randomX, randomY, randomRotate;
                    var overlap = false;
                    var bubbles = $('#bubbleArea').children('.speech-bubble');
                    var canvasW = $('.canvas-area').width();
                    var canvasH = $('.canvas-area').height();
                    var bubbleW = 220; // 仮のバブル幅
                    var bubbleH = 60;  // 仮のバブル高さ
                    // バブル配置範囲をより内側（中央寄り）に制限
                    var minRadius = 18; // 以前より内側から
                    var maxRadius = 32; // 以前より外側を狭める
                    do {
                        var angle = Math.random() * 2 * Math.PI;
                        var radius = minRadius + Math.random() * (maxRadius - minRadius); // 18%〜32%の円周
                        randomX = Math.cos(angle) * radius;
                        randomY = Math.sin(angle) * radius;
                        randomRotate = Math.random() * 10 - 5;
                        // キャンバスの端からはみ出さないように調整
                        var px = canvasW / 2 + (canvasW * randomX / 100);
                        var py = canvasH / 2 + (canvasH * randomY / 100);
                        if (px < bubbleW / 2) randomX = -((canvasW / 2 - bubbleW / 2) / canvasW) * 100;
                        if (px > canvasW - bubbleW / 2) randomX = ((canvasW / 2 - bubbleW / 2) / canvasW) * 100;
                        if (py < bubbleH / 2) randomY = -((canvasH / 2 - bubbleH / 2) / canvasH) * 100;
                        if (py > canvasH - bubbleH / 2) randomY = ((canvasH / 2 - bubbleH / 2) / canvasH) * 100;
                        // 中央領域（-22%〜+22%）は避ける
                        overlap = (Math.abs(randomX) < 22 && Math.abs(randomY) < 22);
                        // 既存バブルと近すぎる場合も避ける
                        bubbles.each(function () {
                            var bx = parseFloat($(this).css('--offset-x')) || 0;
                            var by = parseFloat($(this).css('--offset-y')) || 0;
                            // バブルの中心座標同士の距離を計算
                            var dx = (bx - randomX) * canvasW / 100;
                            var dy = (by - randomY) * canvasH / 100;
                            var distance = Math.sqrt(dx * dx + dy * dy);
                            // バブルの幅・高さを考慮した距離判定
                            var minDist = bubbleW * 0.9; // 90%幅分離す
                            if (distance < minDist) {
                                overlap = true;
                                return false;
                            }
                        });
                        tries++;
                    } while (overlap && tries < 20);
                    // top/left座標で初期位置を設定
                    var leftPx = canvasW / 2 + (canvasW * randomX / 100) - bubbleW / 2;
                    var topPx = canvasH / 2 + (canvasH * randomY / 100) - bubbleH / 2;
                    $bubble.css({
                        left: leftPx + 'px',
                        top: topPx + 'px'
                    });

                    // バブルエリアに追加
                    $("#bubbleArea").append($bubble);
                    // append後にドラッグ可能にする
                    $bubble.draggable({
                        containment: '.canvas-area',
                        scroll: false
                    });

                    // キャンバスに虹色グロー効果
                    var $canvas = $(".canvas-area");
                    $canvas.addClass("rainbow-glow");
                    setTimeout(function () {
                        $canvas.removeClass("rainbow-glow");
                    }, 1200);

                    // 入力欄はクリアしておく
                    $("#voiceInput").val("");
                });

                // 3. まとめをセットするボタンの処理
                $("#setSummaryBtn").on("click", function () {
                    const summary = $("#summaryInput").val().trim();
                    if (summary === "") {
                        alert("まとめを入力してください。");
                        return;
                    }
                    // ヘッダーとキャンバスの間に表示（初回のみ表示）
                    $("#summaryDisplay").text(summary).fadeIn(200);
                    // ボタンのテキストを「決まり」に変更し、色も緑に
                    $(this).text("決まり").addClass("set");
                });

                // まとめポップアップ表示
                $("#showSummaryBtn").on("click", function () {
                    $("#summaryPopup").fadeIn(200);
                });
                // ポップアップ閉じる
                $("#closeSummaryPopup").on("click", function () {
                    $("#summaryPopup").fadeOut(200);
                });

            });
        </script>
        <style>
            /* 入力欄の縦幅を2倍に */
            #voiceInput.textarea,
            #nameInput.text-input {
                height: 64px !important;
                min-height: 64px !important;
                padding-top: 16px;
                padding-bottom: 16px;
            }

            /* 問い入力欄の高さ調整 */
            #questionInput.text-input {
                height: 132px !important;
                min-height: 132px !important;
            }

            /* セクション高さを揃える */
            .side-by-side {
                display: flex;
                align-items: stretch;
            }

            .section-voice,
            .section-question {
                min-height: 340px;
                display: flex;
                flex-direction: column;
            }
        </style>
</body>

</html>